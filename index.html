<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript">
        var shoot = false;
        var fight = false;
        var timeoutId1;
        var stopfight = false;
        var minReactionTime = 400;
        var maxReactionTime = 500;
        var myPoints = 0,
            billPoints = 0;
        var randd;
        
        var rec = 999;



        //          var audio = new Audio(); // Создаём новый элемент Audio
        //  audio.src = 'music/west.mp3'; 
        //  audio.autoplay = false;
        //        audio.volume= 0.4;


        function statustoSteady() {
            document.getElementById("status").innerHTML = "Steady";
            if (shoot == true) {
                gameOver();
                earlyshoot()
            } else
                on2();
        }

        function statustoBANG() {
            document.getElementById("status").innerHTML = "BANG!";
            if (shoot == true) {
                gameOver();
                earlyshoot()
            } else
                on3();
        }


        function earlyshoot() {
            document.getElementById("status").innerHTML = "Выстрел раньше времени...";
        }


        function reset() {
            shoot = false;

            document.myImageL.src = "img/1.jpg";
            document.myImageR.src = "img/1L.jpg";
            document.getElementById("status").innerHTML = "Перемирие";


        }

        function rot() {
            if (fight == false) {
                document.myImageL.src = "img/2.jpg";
                document.myImageR.src = "img/2L.jpg";
                shoot = false;
                fight = true;
                document.getElementById("myReactionSpeed").innerHTML = "Скорость твоей реакции";

                document.getElementById("status").innerHTML = "Ready";

                timeoutId = setTimeout(on1(), 2000);
           
                 var l = document.getElementsByName("radio");
                for(i=0;i<l.length;i++)
                    l[i].disabled=true;
                
                  //   disableChange(); //не вызывается

            }

        }

        function on1() {


            timeoutId = setTimeout(statustoSteady, 2000);

        }

        function on2() {

            var rand = getRandomArbitrary(500, 5000)

            timeoutId = setTimeout(statustoBANG, rand);

        }

        function on3() {
            randd = getRandomArbitrary(minReactionTime, maxReactionTime) //Уровень сложности

            timeoutId1 = setTimeout(off, randd);

            //   stopfight = true;

        }

        function off() {

            if (shoot == true) {
                Win();
            } else {
                gameOver();
            }
           // enableChange(); Не вызывается
            var l = document.getElementsByName("radio");
                for(i=0;i<l.length;i++)
                    l[i].disabled=false;
        }

        function shooting() {
            shoot = true;
            //            if (stopfight == true) {
            //                clearTimeout(timeoutId1); //досрочно завершаем бой
            //                off();
            //                stopfight = false;
            //            }
        }

        function Win() {
            //   alert("Победа!");
            myPoints++;
            document.myImageL.src = "img/fire.gif";
            Rdeath();
            document.getElementById("status1").innerHTML = "Победа";
            document.getElementById("points").innerHTML = myPoints + " : " + billPoints;
            fight = false;
            document.getElementById("myReactionSpeed").innerHTML = "Скорость твоей реакции быстрее, чем " + Math.round(randd) + "мс";
            if(rec > randd)
                {
                    
                  //  rec=math.round(randd);
                 //   alert(math.round(typeof(rec));
                    document.getElementById("myRecord").innerHTML = "Лучший результат "+rec;
                    
                }
        }

        function gameOver() {
            document.myImageR.src = "img/fire1.gif";
            Ldeath();
            billPoints++;
            //alert("Вас убил Слепой Билл");
            document.getElementById("status1").innerHTML = "Поражение";

            document.getElementById("points").innerHTML = myPoints + " : " + billPoints;
            //  timer = setTimeout(reset(), 5000);  //Не срабатывает 
            fight = false;
            document.getElementById("myReactionSpeed").innerHTML = "Скорость твоей реакции медленне, чем " + Math.round(randd) + "мс";
        }

        function Rdeath() {
            var q = getRandomArbitrary(100, 300);
            if (q % 2 == 0)
                document.myImageR.src = "img/death1l.gif";
            else if (q % 3 == 0)
                document.myImageR.src = "img/death2l.gif";
            else
                document.myImageR.src = "img/death3l.gif";

        }

        function Ldeath() {
            var q = getRandomArbitrary(100, 300);
            if (q % 2 == 0)
                document.myImageL.src = "img/death1R.gif";
            else if (q % 3 == 0)
                document.myImageL.src = "img/death2R.gif";
            else
                document.myImageL.src = "img/death3R.gif";

        }

        function getRandomArbitrary(min, max) {
            return Math.random() * (max - min) + min;
        }

        function levelChange() {
            var l = document.getElementsByName("radio");
            if (l[0].checked) {
                document.getElementById("opponent").innerHTML = "Слепой Билли";
                minReactionTime = 600;
                maxReactionTime = 800;
            }
            if (l[1].checked) {
                document.getElementById("opponent").innerHTML = "Безрукий Джон";
                minReactionTime = 250;
                maxReactionTime = 599;
            }
            if (l[2].checked) {
                document.getElementById("opponent").innerHTML = "Чак Норрис";
                minReactionTime = 5;
                maxReactionTime = 15;
            }

            function disableChange() {
                 var ll = document.getElementsByName("radio");
                for(i=0;i<ll.length;i++)
                    ll[i].disabled=true;

            }

            function enableChange() {
                var lll = document.getElementsByName("radio");
                for (i = 0; i < lll.length; i++)
                    lll[i].disabled = false;

            }
        }
    </script>

</head>

<body>


    <table align="center" border="1">
        <thead align="center">
            <h1 align="center">Ковбои</h1></thead>
        <tbody>
            <tr>
                <td colspan="3" id="status1">
                                        Победа или поражение?
                </td>
            </tr>
            <tr>
                <td>
                    <label>
                        <input type="radio" name="radio" checked onclick="levelChange()">
                        <br>Слепой Билли</label>
                </td>
                <td>
                    <label>
                        <input type="radio" name="radio" onclick="levelChange()">
                        <br>Безрукий Джон</label>
                </td>
                <td>
                    <label>
                        <input type="radio" name="radio" onclick="levelChange()">
                        <br>Чак Норрис</label>
                </td>

            </tr>
            <tr>
                <td colspan="3">
                    <button title="Начать дуэль" id="startButton" name="startButton" onclick="rot()"></button>
                </td>

            </tr>
            <tr>
                <td>
                    ТЫ
                </td>
                <td id="points">
                    0 : 0
                </td>
                <td id="opponent">
                    Слепой Билли
                </td>

            </tr>

            <tr>
                <td class="battlefrontL">
                    <img src="img/1.jpg" name="myImageL" title="ТЫ" id="right" width=100% height=100%>
                </td>
                <td class="battlefrontC" id="status" title="Правила просты - Успей убить Билли. Для этого после начала боя дождись слова BANG и затем быстро Стреляй!">Правила</td>
                <td class="battlefrontR">
                    <img src="img/1L.jpg" name="myImageR" title="Твой противник" width=100% height=95%>

                </td>
            </tr>

            <tr>

                <td colspan="3">
                    <button title="Выстрел" id="fireButton" name="fireButton" onclick="shooting()"></button>
                </td>

            </tr>
            <tr>

                <td colspan="3" id="myReactionSpeed">
                    Скорость твоей реакции
                </td>

            </tr>
            
              <tr>

                <td colspan="3" id="myRecord">
                    Лучший результат
                </td>

            </tr>
            <!--
           
-->

        </tbody>
    </table>
    <!--
    <bgsound src="music/west.mp3" loop="1" volume="100" balance="0" />
    <embed src="music/west.mp3" autostart="true" hidden="true" loop="false" align="center">
-->
</body>

</html>